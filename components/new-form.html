<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Registration</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .main-body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        min-height: 100vh;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: black;
      }

      .main-container {
        display: flex;
        max-width: 1200px;
        width: 100%;
        background: linear-gradient(
            135deg,
            transparent 0%,
            transparent 20%,
            rgba(255, 154, 158, 0.3) 25%,
            rgba(255, 154, 158, 0.3) 35%,
            transparent 40%,
            transparent 100%
          ),
          linear-gradient(
            125deg,
            transparent 0%,
            transparent 30%,
            rgba(254, 207, 239, 0.3) 35%,
            rgba(254, 207, 239, 0.3) 45%,
            transparent 50%,
            transparent 100%
          ),
          linear-gradient(
            115deg,
            transparent 0%,
            transparent 40%,
            rgba(199, 215, 255, 0.3) 45%,
            rgba(199, 215, 255, 0.3) 55%,
            transparent 60%,
            transparent 100%
          ),
          linear-gradient(
            105deg,
            transparent 0%,
            transparent 50%,
            rgba(168, 230, 207, 0.3) 55%,
            rgba(168, 230, 207, 0.3) 65%,
            transparent 70%,
            transparent 100%
          ),
          linear-gradient(
            95deg,
            transparent 0%,
            transparent 60%,
            rgba(255, 216, 155, 0.3) 65%,
            rgba(255, 216, 155, 0.3) 75%,
            transparent 80%,
            transparent 100%
          ),
          linear-gradient(
            85deg,
            transparent 0%,
            transparent 70%,
            rgba(255, 204, 203, 0.3) 75%,
            rgba(255, 204, 203, 0.3) 85%,
            transparent 90%,
            transparent 100%
          ),
          rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        min-height: 600px;
      }

      .left-panel {
        /* background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); */
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .left-panel img {
        width: 300px;
        height: 570px;
      }

      .left-panel h2 {
        font-size: 28px;
        font-weight: 300;
        margin-bottom: 15px;
        line-height: 1.2;
      }

      .left-panel p {
        font-size: 16px;
        opacity: 0.9;
        line-height: 1.5;
      }

      .form-container {
        flex: 1.2;
        padding: 40px;
        overflow-y: auto;
      }

      .form-title {
        font-size: 24px;
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 30px;
        text-align: center;
      }

      .form-row {
        display: flex;
        gap: 15px;
      }

      .form-row .form-group {
        flex: 1;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #ffffff;
        margin-bottom: 8px;
      }

      input,
      select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: #f8f9fa;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      input:readonly {
        background: #f1f3f4;
        color: #666;
      }

      .btn {
        flex: 1;
        padding: 14px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 0;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .btn:disabled {
        background: #ddd;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .success-message,
      .error-msg {
        margin-top: 10px;
        padding: 16px 20px;
        border-radius: 12px;
        font-size: 14px;
        display: none;
        animation: fadeIn 0.3s ease;
        position: relative;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .success-message {
        background: linear-gradient(135deg, #00b09b, #96c93d);
        color: white;
        border: none;
      }

      .success-message::before {
        content: "âœ“";
        font-size: 18px;
        font-weight: bold;
        margin-right: 10px;
      }

      .error-msg {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        align-items: center;
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-secondary:hover {
        background: #5a6268;
        box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 768px) {
        .main-container {
          flex-direction: column;
          margin: 10px;
        }
        .btn {
          width: 100%;
          max-width: 300px;
          margin: auto;
        }
        .button-group {
          flex-direction: column;
        }

        .left-panel {
          padding: 30px 20px;
        }

        .form-container {
          padding: 30px 20px;
        }

        .left-panel h2 {
          font-size: 24px;
        }

        .left-panel img {
          display: none;
        }
      }
      @media (max-width: 425px) {
        .left-panel {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-body">
      <div class="main-container">
        <div class="left-panel">
          <img src="../Images/Business_3.webp" alt="" />
        </div>

        <div class="form-container">
          <h3 class="form-title">Order Your Source Code</h3>
          <form id="portfolioRegForm">
            <div class="form-row">
              <div class="form-group">
                <label for="portfolioFullName">Full Name*</label>
                <input type="text" id="portfolioFullName" required />
              </div>
              <div class="form-group">
                <label for="portfolioEmail">Email ID</label>
                <input type="email" id="portfolioEmail" required />
              </div>
            </div>

            <div class="form-group">
              <label for="portfolioAddress">Address*</label>
              <input type="text" id="portfolioAddress" required />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="portfolioPinCode">Pin Code*</label>
                <input
                  type="text"
                  id="portfolioPinCode"
                  maxlength="6"
                  required
                />
              </div>
              <div class="form-group">
                <label for="portfolioCountry">Country</label>
                <input type="text" id="portfolioCountry" readonly />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="portfolioStateName">State</label>
                <input type="text" id="portfolioStateName" readonly />
              </div>
              <div class="form-group">
                <label for="portfolioCityName">City</label>
                <input type="text" id="portfolioCityName" readonly />
              </div>
            </div>

            <div class="form-group">
              <label for="portfolioMobile">Mobile Number*</label>
              <input type="tel" id="portfolioMobile" maxlength="10" required />
            </div>

            <div class="form-group">
              <label for="portfolioProductPlan">Select Product*</label>
              <select id="portfolioProductPlan" required>
                <option value="">Select Product</option>
                <option value="Smart Delivery">Smart Delivery</option>
                <option value="Business Suite">Business Suite</option>
                <option value="CRM">CRM</option>
                <option value="School ERP">School ERP</option>
                <option value="Logistics ERP">Logistics ERP</option>
              </select>
            </div>

            <div
              class="form-group"
              id="portfolioOtpGroup"
              style="display: none"
            >
              <label for="portfolioOtpInput">OTP*</label>
              <input
                type="text"
                id="portfolioOtpInput"
                placeholder="Enter OTP"
                maxlength="6"
              />
            </div>

            <div class="success-message" id="portfolioOtpSuccess">
              OTP sent successfully!
            </div>
            <div class="error-msg" id="portfolioOtpError">
              Error sending OTP!
            </div>

            <div class="button-group">
              <button
                type="button"
                class="btn"
                id="portfolioSendOtpBtn"
                onclick="sendConditionalOtp()"
              >
                Send OTP
              </button>
              <div id="portfolioResendBtnWrapper"></div>
              <button type="button" class="btn" onclick="verifyUnifiedOtp()">
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      function sendConditionalOtp() {
        const phoneField = document.getElementById("portfolioMobile");
        const nameField = document.getElementById("portfolioFullName");
        const phone = phoneField.value.trim();
        const name = nameField.value.trim();

        if (!name) {
          Swal.fire("Error", "Please enter your Full Name.", "error");
          nameField.style.borderColor = "red";
          nameField.focus();
          return;
        } else {
          nameField.style.borderColor = "#e1e5e9";
        }

        if (!/^\d{10}$/.test(phone)) {
          Swal.fire("Error", "Enter valid 10-digit mobile number.", "error");
          phoneField.style.borderColor = "red";
          phoneField.focus();
          return;
        } else {
          phoneField.style.borderColor = "#e1e5e9";
        }

        fetch("https://otp.indraq.info/api/send-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            sender_id: "INDRAQ",
            template_id: "187926",
            phone: "+91" + phone,
            firstName: name,
            appName: "Source_Code_Landing_Page",
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              document.getElementById("portfolioOtpSuccess").style.display =
                "block";
              document.getElementById("portfolioOtpError").style.display =
                "none";
              document.getElementById("portfolioOtpGroup").style.display =
                "block";
              document.getElementById("portfolioSendOtpBtn").style.display =
                "none";

              let resendBtnWrapper = document.getElementById(
                "portfolioResendBtnWrapper"
              );
              resendBtnWrapper.innerHTML = "";

              const btn = document.createElement("button");
              btn.id = "portfolioResendOtpBtn";
              btn.className = "btn btn-secondary";
              btn.disabled = true;
              btn.innerText = "Resend OTP in 30s";
              btn.style.marginTop = "0";
              btn.style.flex = "1";

              btn.onclick = () => {
                btn.disabled = true;
                btn.innerText = "Sending...";
                sendConditionalOtp();
              };

              resendBtnWrapper.appendChild(btn);
              resendBtnWrapper.style.display = "block";

              let timeLeft = 30;
              const interval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                  clearInterval(interval);
                  btn.disabled = false;
                  btn.innerText = "ðŸ”„ Resend OTP";
                } else {
                  btn.innerText = `Resend OTP in ${timeLeft}s`;
                }
              }, 1000);
            } else {
              document.getElementById("portfolioOtpError").innerText =
                data.message || "OTP failed";
              document.getElementById("portfolioOtpError").style.display =
                "block";
            }
          })
          .catch(() => {
            document.getElementById("portfolioOtpError").style.display =
              "block";
          });
      }

      function verifyUnifiedOtp() {
        const form = document.getElementById("portfolioRegForm");

        // Manually check all required fields in the form
        const requiredFields = form.querySelectorAll("[required]");
        let allFieldsValid = true;

        requiredFields.forEach((field) => {
          // Exclude readonly fields as their values are set by JS, not user input
          if (field.readOnly) {
            return; // Skip validation for readonly fields
          }

          if (!field.value.trim()) {
            // Check if the field is empty or just whitespace
            allFieldsValid = false;
            // Optionally, add a visual indicator for the invalid field
            field.style.borderColor = "red";
            field.focus(); // Focus on the first invalid field
            Swal.fire(
              "Error",
              `Please fill in the '${field.previousElementSibling.innerText
                .replace("*", "")
                .trim()}' field.`,
              "error"
            );
            return; // Exit the forEach loop early if an invalid field is found
          } else {
            // Reset border color if valid (useful if it was red before)
            field.style.borderColor = "#e1e5e9";
          }

          // Additional specific validations
          if (
            field.id === "portfolioMobile" &&
            !/^\d{10}$/.test(field.value.trim())
          ) {
            allFieldsValid = false;
            field.style.borderColor = "red";
            field.focus();
            Swal.fire(
              "Error",
              "Please enter a valid 10-digit mobile number.",
              "error"
            );
            return;
          }
          if (
            field.id === "portfolioEmail" &&
            !/\S+@\S+\.\S+/.test(field.value.trim())
          ) {
            allFieldsValid = false;
            field.style.borderColor = "red";
            field.focus();
            Swal.fire("Error", "Please enter a valid email address.", "error");
            return;
          }
        });

        if (!allFieldsValid) {
          return; // Stop the function if any required field is empty/invalid
        }

        const phone = document.getElementById("portfolioMobile").value.trim();
        const otp = document.getElementById("portfolioOtpInput").value.trim();
        const email = document.getElementById("portfolioEmail").value.trim();

        // Now, only proceed with OTP validation if all other fields are valid
        if (
          document.getElementById("portfolioOtpGroup").style.display ===
            "block" &&
          !otp
        ) {
          Swal.fire("Error", "Please enter the OTP.", "error");
          document.getElementById("portfolioOtpInput").focus();
          document.getElementById("portfolioOtpInput").style.borderColor =
            "red";
          return;
        } else if (
          document.getElementById("portfolioOtpGroup").style.display === "block"
        ) {
          document.getElementById("portfolioOtpInput").style.borderColor =
            "#e1e5e9";
        }

        // --- Rest of your existing OTP verification and form submission logic ---

        fetch("https://otp.indraq.info/api/verify-otp", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            phone: "+91" + phone,
            otp,
            appName: "GNVISA",
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              const payload = {
                mobile: phone,
                firstName: document
                  .getElementById("portfolioFullName")
                  .value.trim(),
                email,
                Business_Plan: document
                  .getElementById("portfolioProductPlan")
                  .value.trim(),
                address: document
                  .getElementById("portfolioAddress")
                  .value.trim(),
                pinCode: document
                  .getElementById("portfolioPinCode")
                  .value.trim(),
                country: document
                  .getElementById("portfolioCountry")
                  .value.trim(),
                state: document
                  .getElementById("portfolioStateName")
                  .value.trim(),
                city: document.getElementById("portfolioCityName").value.trim(),
              };

              fetch(
                "https://n8n.indraq.info/webhook/fdc20e5f-f90e-4e6a-aea9-ea75669ba3a6",
                {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(payload),
                }
              ).then((res) => {
                if (res.ok) {
                  Swal.fire({
                    title: "Success",
                    text: "Form submitted successfully!",
                    icon: "success",
                    confirmButtonText: "OK",
                  }).then(() => {
                    document.getElementById("portfolioRegForm").reset();
                    document.getElementById("portfolioOtpGroup").style.display =
                      "none";
                    document.getElementById(
                      "portfolioOtpSuccess"
                    ).style.display = "none";
                    document.getElementById("portfolioOtpError").style.display =
                      "none";
                    document.getElementById(
                      "portfolioSendOtpBtn"
                    ).style.display = "block";
                    document.getElementById(
                      "portfolioResendBtnWrapper"
                    ).innerHTML = "";
                    // Also reset border colors for all fields
                    requiredFields.forEach(
                      (field) => (field.style.borderColor = "#e1e5e9")
                    );
                  });
                } else {
                  Swal.fire(
                    "Error",
                    "Webhook failed. Please try again.",
                    "error"
                  );
                }
              });
            } else {
              Swal.fire("Error", "OTP verification failed", "error");
            }
          })
          .catch(() =>
            Swal.fire("Error", "Server error verifying OTP", "error")
          );
      }

      document
        .getElementById("portfolioPinCode")
        .addEventListener("blur", function () {
          const pin = this.value.trim();
          if (!/^\d{6}$/.test(pin)) return;
          fetch(`https://api.postalpincode.in/pincode/${pin}`)
            .then((res) => res.json())
            .then((data) => {
              if (data[0].Status === "Success") {
                const postOffice = data[0].PostOffice[0];
                document.getElementById("portfolioStateName").value =
                  postOffice.State;
                document.getElementById("portfolioCityName").value =
                  postOffice.District;
                document.getElementById("portfolioCountry").value = "India";
              } else {
                alert("Invalid Pin Code");
              }
            });
        });
    </script>
  </body>
</html>
